### AOP란 ?

AOP는 **Aspect-Oriented Programming**의 약자로, 한국어로는 **관점 지향 프로그래밍**이라고 불립니다. AOP는 객체 지향 프로그래밍(OOP)과 함께 사용되어, 프로그램에서 특정한 횡단 관심사(Cross-Cutting Concerns)를 분리하여 관리하는 방법론입니다. 

### AOP의 기본 개념
객체 지향 프로그래밍(OOP)은 클래스와 객체를 통해 소프트웨어의 주요 기능을 캡슐화하여 모듈화하지만, 때로는 프로그램의 여러 부분에 걸쳐 공통적으로 발생하는 기능이 존재합니다. 예를 들어, 로깅, 보안, 트랜잭션 관리 등이 이에 해당합니다. 이러한 기능들은 여러 클래스에 분산되어 구현될 경우 코드의 중복을 초래하고, 코드 유지보수를 어렵게 만들 수 있습니다.

AOP는 이러한 공통 기능을 별도의 모듈(Aspect)로 분리하여 관리합니다. 이를 통해 핵심 비즈니스 로직과 부가적인 관심사를 분리하여 코드의 응집도를 높이고, 중복 코드를 줄일 수 있습니다.

-  **Aspect** (관점)
Aspect는 여러 클래스에 걸쳐 있는 관심사를 모듈화한 것입니다. 예를 들어, 트랜잭션 관리, 로깅, 보안 등이 대표적인 공통 관심사로서 Aspect로 구현될 수 있습니다. Spring AOP에서 Aspect는 일반 클래스로 구현되며, 두 가지 접근 방식이 있습니다:
    1. **스키마 기반 접근 방식:** XML 설정을 통해 Aspect를 정의합니다.
    2. **@AspectJ 스타일:** `@Aspect` 애노테이션을 사용하여 Aspect를 정의합니다.

- **Join Point** (조인 포인트)
Join Point는 프로그램 실행 중의 특정 시점을 의미합니다. 이는 메서드 실행, 예외 처리 등 다양한 순간일 수 있습니다. Spring AOP에서는 Join Point가 항상 **메서드 실행**을 나타냅니다. 즉, 메서드가 호출되거나 반환되는 시점에서 Aspect가 개입할 수 있는 지점입니다.

- **Advice** (어드바이스)
Advice는 특정 Join Point에서 Aspect가 수행하는 동작을 말합니다. Spring AOP에서는 다양한 종류의 Advice가 제공되며, 이를 통해 Aspect가 메서드 실행 전, 후, 또는 실행 중에 개입할 수 있습니다.
Advice는 일반적으로 **인터셉터 체인**의 형태로 구현되어 Join Point 주변에서 동작합니다.  
주요 어드바이스 종류는 다음과 같습니다:
    1. **Before:** 메서드 실행 전에 실행됩니다.
    2. **After:** 메서드 실행 후에 실행됩니다.
    3. **Around:** 메서드 실행 전후에 모두 실행되며, 메서드 호출을 제어할 수 있습니다.  


- **Pointcut** (포인트컷)
Pointcut은 특정 Join Point를 매칭하는 조건을 정의합니다. Advice는 Pointcut 표현식과 연결되어 있으며, Pointcut이 매칭되는 모든 Join Point에서 Advice가 실행됩니다. 예를 들어, 특정 패턴의 메서드 이름을 가진 메서드 실행에 대해 Advice를 적용할 수 있습니다. Spring AOP는 기본적으로 AspectJ의 Pointcut 표현식 언어를 사용하여 이러한 조건을 정의합니다.

- **Introduction** (인트로덕션)
Introduction은 기존의 타입에 새로운 메서드나 필드를 추가하는 것을 의미합니다. Spring AOP에서는 Introduction을 사용하여 어드바이스된 객체에 새로운 인터페이스(및 해당 구현)를 도입할 수 있습니다. 예를 들어, Introduction을 통해 빈이 `IsModified` 인터페이스를 구현하도록 하여 상태 변경을 추적하는 기능을 추가할 수 있습니다. AspectJ 커뮤니티에서는 이것을 **inter-type 선언**이라고도 합니다.

- **Target Object** (타겟 객체)
Target Object는 하나 이상의 Aspect에 의해 어드바이스된 객체를 의미합니다. 일반적으로 "어드바이스된 객체"라고도 불리며, Spring AOP에서는 이 객체가 항상 **프록시 객체**입니다. 즉, 실제 객체가 아닌 프록시 객체가 생성되어 런타임에 Aspect의 기능이 적용됩니다.

- **AOP Proxy** (AOP 프록시)
AOP Proxy는 Aspect와 관련된 계약(예: 어드바이스 메서드 실행)을 구현하기 위해 AOP 프레임워크에서 생성한 객체입니다. Spring Framework에서는 AOP 프록시가 **JDK 동적 프록시** 또는 **CGLIB 프록시**로 구현됩니다. JDK 동적 프록시는 인터페이스 기반으로, CGLIB 프록시는 클래스 기반으로 프록시를 생성합니다.

- **Weaving** (위빙)
Weaving은 Aspect와 다른 애플리케이션 타입이나 객체를 결합하여 어드바이스된 객체를 생성하는 과정입니다. 이 과정은 다양한 시점에서 수행될 수 있습니다:
- **컴파일 타임:** 소스 코드를 컴파일할 때 Aspect를 결합합니다. AspectJ 컴파일러를 사용하는 경우가 여기에 해당됩니다.
- **로드 타임:** 클래스 로더가 클래스를 로드할 때 Aspect를 결합합니다.
- **런타임:** 프로그램이 실행되는 동안 동적으로 Aspect를 결합합니다. Spring AOP는 순수 자바 AOP 프레임워크로, 런타임에 위빙을 수행합니다. 이 방식은 주로 프록시 객체를 사용하여 구현됩니다.

- **Weaver** (위버)
위버(Weaver)는 위빙을 수행하는 구성 요소입니다. 위버는 프로그램의 특정 시점에서(컴파일 타임, 로드 타임, 런타임) Aspect를 핵심 애플리케이션 로직에 결합시킵니다. 위버는 각 시점에 맞는 방식으로 Aspect를 적용하며, 이를 통해 최종적으로 어드바이스된 객체를 생성하게 됩니다.  
위버는 AOP의 핵심 역할을 담당하며, 적절한 시점에 적절한 방식으로 Aspect를 애플리케이션에 적용하는 역할을 합니다. Spring AOP에서는 런타임 위빙이 주로 사용되므로, 런타임 위버가 프록시 객체를 생성하여 동적으로 Aspect를 적용합니다.  
이와 같이, AOP는 객체 지향 프로그래밍의 한계를 보완하고 공통 관심사를 모듈화하여 코드의 응집도를 높이고 유지보수를 용이하게 합니다.

Spring AOP에서 제공하는 어드바이스(Advice) 유형은 AOP의 핵심 개념으로, 다양한 방식으로 조인 포인트(Join Point)에서 특정 동작을 실행할 수 있도록 합니다. 각 어드바이스 유형과 Spring AOP의 전반적인 특징을 가독성 좋게 정리하겠습니다.

### Spring AOP의 어드바이스 유형

1. **Before Advice**
   - **설명:** 조인 포인트가 실행되기 **전에** 수행되는 어드바이스입니다.
   - **특징:** 조인 포인트로의 실행 흐름을 변경할 수는 없으며, 예외를 발생시키지 않는 한, 원래 메서드는 예정된 대로 실행됩니다.
   - **사용 사례:** 메서드 실행 전의 유효성 검사, 로깅 등.

2. **After Returning Advice**
   - **설명:** 조인 포인트가 정상적으로 완료된 후(즉, 메서드가 예외를 던지지 않고 성공적으로 반환된 경우) 실행되는 어드바이스입니다.
   - **특징:** 메서드의 결과를 기반으로 후처리 작업을 수행할 수 있습니다.
   - **사용 사례:** 메서드 실행 결과를 로깅하거나, 반환 값을 수정하여 클라이언트에 전달.

3. **After Throwing Advice**
   - **설명:** 메서드가 예외를 던져 종료될 때 실행되는 어드바이스입니다.
   - **특징:** 발생한 예외에 대한 로깅이나 예외 처리 로직을 추가할 수 있습니다.
   - **사용 사례:** 예외 발생 시 추가적인 복구 작업이나 로깅을 수행.

4. **After (Finally) Advice**
   - **설명:** 조인 포인트가 **어떤 방식으로 종료되든**(정상 종료 또는 예외 발생) 항상 실행되는 어드바이스입니다.
   - **특징:** 메서드가 종료될 때 반드시 실행되어야 하는 청소 작업이나 리소스 해제를 수행할 수 있습니다.
   - **사용 사례:** 파일이나 데이터베이스 연결을 닫는 작업 등.

5. **Around Advice**
   - **설명:** 메서드 호출과 같은 조인 포인트를 둘러싸는 어드바이스로, 가장 강력한 어드바이스 유형입니다.
   - **특징:** 메서드 호출 전후에 커스텀 동작을 수행할 수 있으며, 조인 포인트로의 실행을 계속 진행할지, 자체 반환 값을 반환하거나 예외를 발생시킬지 선택할 수 있습니다.
   - **사용 사례:** 트랜잭션 관리, 메서드 실행 전후의 로깅 또는 성능 모니터링.
   - **참고:** **proceed()** 메서드를 호출하여 조인 포인트의 실행을 제어해야 합니다.

   > **Note:** Around 어드바이스는 매우 유연하고 강력하지만, 가능한 경우 더 구체적인 어드바이스 유형(Before, After 등)을 사용하는 것이 좋습니다. 더 구체적인 어드바이스 유형은 코드의 복잡성을 줄이고, 오류 발생 가능성을 낮춥니다.


### AOP의 적용 예
- **로깅:** 모든 메소드 호출에 대해 로깅을 하는 기능을 Aspect로 구현하여 코드 중복을 제거할 수 있습니다.
  
- **트랜잭션 관리:** 데이터베이스와 상호작용하는 메소드에 대해 트랜잭션 관리를 Aspect로 구현하여, 트랜잭션 시작과 종료를 자동으로 처리할 수 있습니다.
  
- **보안:** 메소드 실행 전 권한을 체크하는 로직을 Aspect로 분리하여 코드의 가독성을 높이고 유지보수를 용이하게 할 수 있습니다.

### AOP의 장점
- **코드 중복 감소:** 공통 관심사를 한 곳에서 관리할 수 있어 코드 중복이 줄어듭니다.
- **코드의 응집도 향상:** 핵심 비즈니스 로직과 부가적인 관심사를 분리할 수 있어 코드의 응집도가 높아집니다.
- **유지보수 용이:** 공통 기능이 변경되더라도 Aspect만 수정하면 되므로 유지보수가 용이합니다.

### 5. AOP 프레임워크
대표적인 AOP 프레임워크로는 **Spring AOP**(Java 기반), **AspectJ** 등이 있습니다. 이들 프레임워크는 AOP의 개념을 쉽게 적용할 수 있도록 도와줍니다.

AOP는 특히 대규모 소프트웨어 시스템에서 유지보수성과 코드 품질을 높이기 위해 자주 사용되며, 객체 지향 프로그래밍의 한계를 보완하는 강력한 도구로 평가받고 있습니다.

### 포인트컷(Pointcut)과 조인 포인트(Join Point)
- **포인트컷(Pointcut):** 조인 포인트를 매칭하는 조건을 정의하는 표현식입니다. 어드바이스는 포인트컷에 의해 선택된 조인 포인트에서 실행됩니다. 예를 들어, 특정 패턴의 메서드 이름에 해당하는 메서드 실행을 선택할 수 있습니다.
- **조인 포인트(Join Point):** 프로그램 실행 중 어드바이스가 적용될 수 있는 특정 지점을 의미합니다. Spring AOP에서는 메서드 실행만을 조인 포인트로 지원합니다.

### Spring AOP의 목표와 기능
Spring AOP는 순수 자바로 구현되어, 특별한 컴파일 과정 없이 쉽게 사용할 수 있습니다. 또한, 클래스 로더 계층을 제어할 필요가 없어 서블릿 컨테이너나 애플리케이션 서버에서 사용하기에 적합합니다. 현재 Spring AOP는 메서드 실행 조인 포인트만을 지원하며, 필드 인터셉션은 지원하지 않습니다. 필드 접근과 업데이트에 대한 어드바이스가 필요하다면, AspectJ와 같은 AOP 프레임워크를 고려해야 합니다.

Spring AOP는 완전한 AOP 구현을 목표로 하지 않으며, 대신 Spring IoC 컨테이너와의 긴밀한 통합을 통해 엔터프라이즈 애플리케이션에서 발생하는 공통 문제를 해결하는 데 중점을 둡니다. 이 접근 방식은 Spring AOP가 대부분의 엔터프라이즈 자바 애플리케이션에서 매우 효과적인 솔루션을 제공하게 합니다.

### AOP 프록시와 Spring AOP
- **AOP 프록시:** Spring AOP는 JDK 동적 프록시나 CGLIB 프록시를 사용하여 프록시 객체를 생성합니다. JDK 동적 프록시는 인터페이스를 기반으로 프록시를 생성하며, CGLIB 프록시는 클래스를 기반으로 프록시를 생성합니다. 인터페이스가 있는 경우 JDK 동적 프록시가 사용되며, 인터페이스가 없는 경우 CGLIB 프록시가 사용됩니다.
- **프록시 기반:** Spring AOP는 프록시 기반으로 구현되었으며, 이 점은 Spring AOP의 기본적인 구현 원리입니다.

### 비침투성(Non-Invasiveness) 원칙
Spring Framework의 중요한 원칙 중 하나는 비침투성입니다. 이는 비즈니스 로직이나 도메인 모델에 프레임워크 특정 클래스나 인터페이스를 강제로 도입하지 않는 것을 의미합니다. 그러나 특정 시나리오에서는 Spring 관련 의존성을 도입할 수 있는 옵션을 제공합니다. Spring AOP에서는 개발자가 AspectJ, Spring AOP, 또는 둘 다 사용할 수 있으며, @AspectJ 애노테이션 스타일 또는 Spring XML 구성 스타일 중에서 선택할 수 있습니다.

### 결론
Spring AOP는 강력한 AOP 기능을 제공하며, 특히 Spring IoC와의 통합을 통해 엔터프라이즈 애플리케이션에서 자주 발생하는 문제를 효과적으로 해결합니다. Spring AOP는 AspectJ와 같은 완전한 AOP 프레임워크와 상호 보완적인 역할을 하며, 상황에 따라 적절한 도구를 선택해 사용할 수 있는 유연성을 제공합니다.

