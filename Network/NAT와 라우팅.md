### **NAT(Network Address Translation)**

NAT는 **네트워크 주소 변환(Network Address Translation)**의 약자로, 네트워크 장치(일반적으로 라우터)가 **사설 네트워크의 IP 주소를 공인 IP 주소로 변환**하거나 그 반대로 변환하는 기술을 말합니다. NAT는 인터넷과 같은 공용 네트워크에서 사설 네트워크 장치들이 효율적으로 통신할 수 있도록 돕습니다.

---

## **1. NAT의 필요성**

1. **IPv4 주소 부족 문제 해결**:
   - IPv4는 32비트 주소 체계를 사용하며, 최대 약 43억 개의 고유한 IP 주소를 제공합니다.
   - 인터넷 장치의 수가 폭발적으로 증가하면서 IPv4 주소가 부족해졌습니다.
   - NAT는 여러 장치가 하나의 공인 IP 주소를 공유하도록 만들어 이 문제를 완화합니다.

2. **사설 네트워크 보호**:
   - NAT는 사설 네트워크의 IP 주소를 외부에 노출하지 않으므로 기본적인 보안 기능을 제공합니다.
   - 외부에서 사설 네트워크 장치를 직접 접근하기 어렵게 만듭니다.

---

## **2. NAT의 작동 원리**

1. **사설 IP와 공인 IP**:
   - **사설 IP(Private IP)**: 로컬 네트워크에서만 사용되며, 인터넷에서는 사용할 수 없습니다.
     - 예: 192.168.x.x, 10.x.x.x, 172.16.x.x ~ 172.31.x.x
   - **공인 IP(Public IP)**: 인터넷 상에서 고유하게 식별되는 IP 주소입니다.

2. **NAT 테이블**:
   - NAT는 요청마다 사설 IP와 포트를 공인 IP와 포트로 매핑합니다.
   - 이를 라우터 내부의 **NAT 테이블**에 저장합니다.
   - 응답이 돌아오면 NAT 테이블을 참조해 원래의 사설 IP로 패킷을 전달합니다.

3. **변환 과정**:
   - 사설 네트워크의 장치가 인터넷에 요청을 보낼 때, NAT는 **출발지 IP**를 공인 IP로 변환합니다.
   - 인터넷에서 반환된 응답 패킷의 **목적지 IP**를 원래 사설 IP로 다시 변환합니다.

---

## **3. NAT의 종류**

1. **Static NAT (정적 NAT)**:
   - 하나의 사설 IP를 특정 공인 IP와 1:1로 매핑합니다.
   - 주로 서버에 사용됩니다.

   **예시**:
   - 사설 IP `192.168.1.10` → 공인 IP `203.0.113.10`

2. **Dynamic NAT (동적 NAT)**:
   - 사설 IP를 공인 IP 풀(Pool) 중 하나로 동적으로 매핑합니다.
   - 공인 IP 주소의 개수는 사설 네트워크 장치보다 적을 수 있습니다.

   **예시**:
   - 사설 IP `192.168.1.10` → 공인 IP 풀에서 `203.0.113.5`로 할당.

3. **PAT(Port Address Translation)** 또는 NAT Overload:
   - 가장 일반적인 NAT 방식으로, 다수의 사설 IP를 하나의 공인 IP로 매핑합니다.
   - 각 연결은 고유한 **포트 번호**를 사용하여 구분됩니다.

   **예시**:
   - 사설 IP `192.168.1.10:1025` → 공인 IP `203.0.113.1:30001`
   - 사설 IP `192.168.1.11:1026` → 공인 IP `203.0.113.1:30002`

---

## **4. NAT의 장단점**

### **장점**
1. **IPv4 주소 절약**:
   - NAT를 통해 여러 장치가 하나의 공인 IP 주소를 공유할 수 있습니다.

2. **보안 강화**:
   - 외부 네트워크에서 사설 네트워크 장치에 직접 접근하기 어렵습니다.

3. **유연성**:
   - 네트워크 변경 시 내부 사설 네트워크 구조를 수정할 필요가 없습니다.

---

### **단점**
1. **추가 처리 부담**:
   - NAT는 패킷마다 IP 변환을 수행하므로 라우터에 추가적인 처리 부담을 줍니다.

2. **P2P 통신 제한**:
   - NAT는 외부 장치가 사설 네트워크의 장치에 직접 접근하는 것을 어렵게 합니다.
   - 예: 온라인 게임, 비디오 회의, P2P 파일 공유 등에서 문제 발생 가능.

3. **종단 간 연결 문제**:
   - IP 주소가 변경되기 때문에 **End-to-End 통신**을 보장하지 못합니다.
   - NAT를 사용하는 환경에서는 일부 프로토콜(IPSec, VoIP 등)이 비효율적일 수 있습니다.

---

## **5. NAT의 실제 사용 예시**

1. **가정용 네트워크**:
   - 집에서 사용하는 라우터는 공인 IP 주소를 통해 ISP(인터넷 서비스 제공자)와 통신합니다.
   - NAT를 사용해 모든 가정 내 장치(사설 IP 주소)가 인터넷에 접속할 수 있습니다.

   **예**:
   - 노트북(192.168.0.2), 스마트폰(192.168.0.3), 스마트 TV(192.168.0.4)가 NAT를 통해 공인 IP(203.0.113.1)를 공유.

2. **기업 네트워크**:
   - 사무실 네트워크에서 수백 대의 컴퓨터가 NAT를 통해 공인 IP 하나 또는 일부를 공유하며 인터넷에 접속.

3. **클라우드 환경**:
   - AWS, GCP, Azure와 같은 클라우드 플랫폼에서는 가상 머신(VM)이 사설 IP를 사용하며, NAT 게이트웨이를 통해 공인 IP를 사용하여 인터넷과 통신합니다.

---

## **6. NAT와 관련된 기술**
1. **NAT 게이트웨이**:
   - 클라우드에서 NAT를 수행하는 전용 장치(서비스).
   - AWS의 NAT 게이트웨이, GCP의 Cloud NAT 등.

2. **포트 포워딩(Port Forwarding)**:
   - NAT 환경에서 외부 장치가 특정 내부 장치에 접근할 수 있도록 포트를 매핑.
   - 예: 203.0.113.1:8080 → 192.168.0.10:80 (웹 서버).

3. **NAT Traversal**:
   - NAT 환경에서 P2P 연결 문제를 해결하기 위한 기술.
   - STUN(Session Traversal Utilities for NAT), TURN, ICE 등이 사용됨.

---

### **7. NAT와 IPv6**

- IPv6에서는 주소 공간이 거의 무한에 가까우므로, NAT의 필요성이 크게 줄어듭니다.
- 대신 IPv6는 고유 IP를 사용하는 **End-to-End 통신**을 강조합니다.
- 다만, 보안 목적으로 여전히 NAT를 사용하는 경우도 있습니다.

---

## 라우팅