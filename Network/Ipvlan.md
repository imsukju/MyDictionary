**IPvlan**은 리눅스 커널에서 제공하는 네트워크 가상화 기술로, 단일 물리적 네트워크 인터페이스를 기반으로 여러 개의 **가상 네트워크 인터페이스**를 생성하고, **공유된 MAC 주소**를 통해 각 인터페이스가 서로 독립적으로 네트워크 통신을 수행하도록 하는 방식입니다. 이는 **Macvlan**과 유사하지만, MAC 주소를 추가 생성하지 않고 **IP 주소를 기반으로 네트워크 격리**를 수행합니다.

---

## **1. IPvlan의 정의**

IPvlan은 물리적 네트워크 인터페이스(부모 인터페이스)를 기반으로 여러 개의 자식 인터페이스를 생성하며, 자식 인터페이스들은 부모 인터페이스와 동일한 MAC 주소를 사용합니다. 네트워크 트래픽은 **IP 주소를 기준으로 분리**되며, 컨테이너, 가상머신, 또는 네트워크 격리가 필요한 애플리케이션에서 활용됩니다.

---

## **2. IPvlan의 작동 원리**

IPvlan은 물리적 인터페이스(부모 인터페이스)에서 생성된 **가상 네트워크 인터페이스(IPVlan 인터페이스)**를 통해 트래픽을 관리합니다.

1. **부모 인터페이스 (Parent Interface)**:
    - IPvlan 인터페이스가 생성되는 물리적 네트워크 인터페이스.
    - 예: `eth0`.
2. **자식 인터페이스 (Child Interface)**:
    - IPvlan 드라이버에 의해 생성된 가상 네트워크 인터페이스.
    - 각 자식 인터페이스는 고유한 IP 주소를 가지지만, 부모 인터페이스와 동일한 MAC 주소를 공유.
3. **MAC 주소 공유**:
    - 모든 IPvlan 인터페이스는 동일한 MAC 주소를 사용하므로, 네트워크 환경에서는 물리적 인터페이스에서만 MAC 주소가 보입니다.
    - 이는 네트워크 트래픽이 간소화되고 일부 하드웨어 네트워크 환경에서 호환성을 높이는 데 유리합니다.
4. **IP 주소 기반 격리**:
    - IPvlan은 IP 주소를 기준으로 트래픽을 분리하고 관리합니다.
    - 동일한 MAC 주소를 사용하지만, 각각의 IP 주소는 독립적으로 트래픽을 처리합니다.

---

## **3. IPvlan의 모드**

IPvlan은 트래픽 처리 방식에 따라 두 가지 모드로 동작합니다.

### **1) L2 모드 (Layer 2 모드)**

- IPvlan 인터페이스가 물리적 네트워크에 직접 연결된 것처럼 동작.
- 트래픽은 **로컬 브로드캐스트 도메인**에서 처리됩니다.
- 부모 인터페이스와 자식 인터페이스 간 직접 통신이 가능.
- **사용 사례**:
    - 컨테이너가 동일한 서브넷 내에서 통신해야 하는 경우.

### **2) L3 모드 (Layer 3 모드)**

- IPvlan 인터페이스는 라우팅을 통해 통신.
- 트래픽은 부모 인터페이스를 경유하여 외부 네트워크로 전달되며, **로컬 브로드캐스트 도메인**이 아니라 **라우팅 기반**으로 작동.
- **사용 사례**:
    - 컨테이너가 서로 다른 서브넷에 배치되거나, 외부 네트워크와 격리된 환경에서 통신해야 하는 경우.

---

## **4. IPvlan의 특징**

### **1) Macvlan과의 주요 차이점**

| **특징** | **IPvlan** | **Macvlan** |
| --- | --- | --- |
| **MAC 주소** | 부모 인터페이스와 동일한 MAC 주소 사용 | 자식 인터페이스마다 고유한 MAC 주소 생성 |
| **트래픽 관리** | IP 주소를 기준으로 트래픽 분리 | MAC 주소를 기준으로 트래픽 분리 |
| **호환성** | 물리적 네트워크 스위치 및 장비와 호환성 높음 | 네트워크 스위치가 여러 MAC 주소를 처리해야 할 수 있음 |
| **성능** | MAC 주소 관리가 없으므로 더 간단하고 성능 우수 | MAC 주소 생성으로 인해 오버헤드 가능 |
| **부모-자식 간 통신** | 부모와 자식 간 통신 가능 (L2 모드) | 부모와 자식 간 직접 통신 불가능 |

---

### **2) 성능**

- IPvlan은 **MAC 주소 생성 오버헤드가 없기 때문에** Macvlan보다 더 간단하고 빠른 성능을 제공.
- 특히 대규모 가상 네트워크 환경에서 효율적.

### **3) IP 주소 기반 트래픽 분리**

- IPvlan은 IP 주소를 기준으로 트래픽을 관리하므로, 동일한 물리적 인터페이스에서 더 간단하게 네트워크 격리 구현.

---

## **5. IPvlan의 장점**

1. **단순화된 MAC 주소 관리**
    - 물리적 네트워크에서는 하나의 MAC 주소만 관리하므로, 네트워크 스위치와의 호환성이 높음.
    - VLAN, 다중 MAC 주소 제한이 있는 네트워크에서도 사용 가능.
2. **성능 최적화**
    - MAC 주소 생성과 관리 오버헤드가 없어 네트워크 성능이 우수.
3. **유연성**
    - L2 모드와 L3 모드를 통해 다양한 네트워크 격리 및 연결 요구를 충족.
4. **호환성**
    - 하드웨어 네트워크 환경에서 Macvlan보다 더 높은 호환성을 제공.
5. **네트워크 격리**
    - IP 주소를 기반으로 네트워크를 논리적으로 분리 가능.

---

## **6. IPvlan의 단점**

1. **MAC 주소 공유로 인한 제한**
    - 모든 인터페이스가 동일한 MAC 주소를 사용하므로, 일부 네트워크 환경에서 추가적인 라우팅 또는 네트워크 설정이 필요.
2. **복잡한 네트워크 구성**
    - L3 모드에서 라우팅을 추가로 설정해야 할 수 있음.
3. **IP 주소 의존성**
    - IP 주소 기반으로 작동하므로, IP 주소 관리가 중요한 환경에서는 복잡성이 증가.

---

## **7. IPvlan의 주요 사용 사례**

### **1) 컨테이너 네트워크**

- **Docker**:
    - Docker에서 IPvlan 드라이버를 사용해 컨테이너에 독립적인 IP 주소를 제공.
    - 동일한 물리적 NIC를 기반으로 다수의 컨테이너를 독립적인 네트워크 환경에서 동작 가능.
- **사용 예**:
    - 컨테이너가 외부 네트워크와 직접 통신하거나, 특정 서브넷에 고정 IP 주소가 필요할 때.

### **2) 클라우드 환경**

- IPvlan은 클라우드 환경에서 네트워크 격리를 구현하거나 다중 네트워크 인터페이스를 구성하는 데 사용.

### **3) 데이터센터 및 IoT 환경**

- 데이터센터 내에서 가상머신 및 컨테이너 간 격리된 네트워크 설정.
- IoT 장치에서 IPvlan을 통해 논리적 네트워크 구성.

---

## **8. IPvlan 설정 방법**

IPvlan은 리눅스 명령어 또는 Docker를 통해 설정할 수 있습니다.

### **1) 리눅스 명령어로 IPvlan 설정**

```bash
# 1. 부모 인터페이스 확인
ip link show

# 2. IPvlan 인터페이스 생성 (L2 모드)
sudo ip link add ipvlan0 link eth0 type ipvlan mode l2

# 3. IPvlan 인터페이스 활성화
sudo ip link set ipvlan0 up

# 4. IP 주소 할당
sudo ip addr add 192.168.1.100/24 dev ipvlan0

```

### **2) Docker에서 IPvlan 설정**

```bash
# IPvlan 네트워크 생성
docker network create -d ipvlan \
  --subnet=192.168.1.0/24 \
  --gateway=192.168.1.1 \
  -o parent=eth0 \
  ipvlan_network

# IPvlan 네트워크를 사용하는 컨테이너 실행
docker run --rm --net=ipvlan_network alpine ifconfig

```

---

## **9. IPvlan과 Macvlan 비교 요약**

| **특징** | **IPvlan** | **Macvlan** |
| --- | --- | --- |
| **MAC 주소** | 부모 인터페이스와 공유 | 각 인터페이스에 고유한 MAC 주소 |
| **트래픽 분리** | IP 주소 기반 분리 | MAC 주소 기반 분리 |
| **성능** | 더 간단하고 빠름 | 약간의 오버헤드 있음 |
| **호환성** | 더 높은 호환성 제공 | 일부 제한된 네트워크 환경 있음 |
| **모드** | L2, |  |

L3 모드                      | Bridge, VEPA, Private 등 다양한 모드 |

---

## **결론**

**IPvlan**은 네트워크 격리, 성능 최적화, 그리고 단순한 설정이 필요한 환경에서 매우 유용한 기술입니다. 특히 **컨테이너 기반의 워크로드**, **클라우드 네트워크**, 그리고 **데이터센터 환경**에서 널리 사용됩니다. Macvlan과 비교했을 때, MAC 주소 관리를 단순화하고 성능을 최적화할 수 있다는 점에서 유리하며, IP 주소 기반으로 작동하기 때문에 네트워크 설계 시 적합한 선택입니다.