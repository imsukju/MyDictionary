
## **토큰 (Token)**

웹 애플리케이션에서 클라이언트와 서버 간 안전한 통신을 위해 **토큰(Token)**이 사용됩니다. **HTTP 프로토콜은 상태 비저장(stateless)**으로 설계되어, 클라이언트의 로그인 상태를 유지하거나 사용자를 식별하기 위해 요청마다 인증이 필요합니다. **토큰 기반 인증 방식**은 사용자 인증, 권한 부여, 세션 관리 등을 보다 안전하고 효율적으로 처리하며, 이를 통해 웹 애플리케이션의 보안성과 확장성을 크게 높여줍니다.

### **토큰의 생성과 전송 과정**

1. **사용자 인증**:
    - 사용자가 로그인을 시도하면 서버는 사용자의 자격 증명을 확인하여 이를 바탕으로 **토큰**을 생성해 반환합니다.
    - **토큰**은 주로 **JWT(JSON Web Token)** 형식으로, 인증에 필요한 정보를 담고 있으며, 이를 위조할 수 없도록 서버에서 서명(Signature)을 포함하여 생성합니다.

2. **토큰의 구성 요소**:
    - **JWT**는 **헤더(Header)**, **페이로드(Payload)**, **서명(Signature)**의 세 부분으로 이루어집니다.
        - **헤더**: 토큰 유형과 암호화 방식을 정의합니다.
        - **페이로드**: 사용자 ID, 권한, 만료 시간 등 인증 및 권한 부여에 필요한 정보를 담고 있습니다.
        - **서명**: 서버가 헤더와 페이로드를 비밀 키로 해싱하여 생성한 값으로, 토큰이 위조되지 않음을 보장합니다.

3. **토큰 전송**:
    - 클라이언트는 서버에 요청을 보낼 때마다 이 토큰을 전송하여 본인을 인증합니다.
    - 토큰은 **HTTP 헤더**(예: `Authorization: Bearer [토큰]`), **쿠키**, **URL 파라미터** 등을 통해 전송됩니다.

4. **서버의 토큰 검증**:
    - 서버는 **Signature**를 검증하여 토큰이 위조되지 않았는지 확인하며, 만료 시간도 함께 확인합니다.
    - 유효하지 않거나 만료된 토큰이 있을 경우 서버는 요청을 거부하고, 필요 시 **Refresh Token**을 통해 토큰을 재발급하여 사용자가 다시 인증 과정을 거치지 않도록 합니다.

### **토큰의 주요 기능과 목적**

1. **인증 (Authentication)**:
    - **토큰**은 사용자가 누구인지 서버에 알려주는 역할을 합니다. 사용자가 인증을 완료한 후 서버가 발급한 토큰을 클라이언트가 저장하고, 이후 각 요청마다 이를 포함하여 인증 절차를 반복하지 않고도 본인을 증명할 수 있습니다.

2. **세션 관리 (Session Management)**:
    - **토큰**을 이용하면 세션을 관리하는 방식과 다르게 클라이언트가 직접 토큰을 관리하여 서버의 부담을 줄일 수 있습니다.
    - 이로 인해 서버는 별도의 세션 저장소를 유지하지 않아도 되며, 확장성 있는 서버 환경을 구현할 수 있습니다.

3. **권한 부여 (Authorization)**:
    - 토큰에는 사용자 권한 정보가 포함될 수 있으며, 서버는 이를 통해 사용자가 요청한 리소스에 접근할 권한이 있는지를 판단할 수 있습니다.
    - 예를 들어, 관리자와 일반 사용자의 권한을 다르게 설정하여 특정 자원에 대한 접근을 제어할 수 있습니다.

4. **보안 (Security)**:
    - **토큰**은 서버에서 서명하여 생성하므로, 변조 방지가 가능합니다.
    - 이를 통해 **CSRF(Cross-Site Request Forgery)**와 같은 공격을 예방하고, 클라이언트와 서버 간의 안전한 통신을 보장할 수 있습니다.

5. **크로스 도메인 요청 (Cross-Domain Requests)**:
    - 토큰은 **CORS(Cross-Origin Resource Sharing)**을 지원하는 방식으로 다른 도메인에서도 사용이 가능하여 유연하게 크로스 도메인 요청을 처리할 수 있습니다.

---

## **JWT (JSON Web Token)**

**JWT**는 두 개체 간 **JSON** 형식의 정보를 안전하게 전송하기 위한 표준 토큰입니다. 웹 애플리케이션에서 주로 사용자 인증 및 정보 교환에 사용되며, 서버와 클라이언트 간 상태 유지와 신뢰할 수 있는 데이터 전송을 지원합니다.

### **JWT의 구성 요소**

**JWT**는 **헤더(Header)**, **페이로드(Payload)**, **서명(Signature)**의 세 부분으로 구성됩니다. 각 부분은 점(`.`)으로 구분되어 있습니다.

1. **헤더 (Header)**:
    - **토큰 유형**과 **서명에 사용될 알고리즘**을 명시합니다.
    - 주로 `{"alg": "HS256", "typ": "JWT"}` 형식으로 설정되며, 이를 통해 서버는 토큰의 처리 방법을 결정합니다.

2. **페이로드 (Payload)**:
    - **JWT**의 본문으로, 사용자에 관한 데이터와 인증 정보를 포함합니다.
    - **등록된 클레임(Registered Claims)**, **공개 클레임(Public Claims)**, **비공개 클레임(Private Claims)**으로 구분되며, 사용자의 고유 ID, 권한, 만료 시간 등의 정보를 담고 있습니다.

3. **서명 (Signature)**:
    - **서명**은 헤더와 페이로드를 인코딩하여 서버의 비밀 키로 해싱한 값으로, 토큰의 무결성을 보장합니다.
    - 예: `HMACSHA256(base64UrlEncode(header) + "." + base64UrlEncode(payload), secret)`

### **JWT의 작동 원리**

1. 사용자가 로그인하면 서버는 사용자의 인증 정보를 확인한 후, 해당 사용자에 대한 정보를 담아 **서명이 포함된 JWT**를 생성하여 클라이언트에게 전달합니다.
2. 클라이언트는 이후 모든 요청마다 이 토큰을 함께 보내어 자신을 인증하며, 서버는 클라이언트가 보낸 토큰의 서명을 검증하여 신뢰할 수 있는 정보인지 확인합니다.

---

### **JWT의 장점**

1. **자가 포함된 구조**:
    - 서버가 추가로 세션을 저장하지 않아도 필요한 정보가 토큰에 모두 포함되어 있습니다.
2. **서명 및 검증 가능**:
    - 디지털 서명 또는 암호화를 통해 보안이 강화되며, 발행자가 신뢰할 수 있는 출처임을 확인할 수 있습니다.
3. **Base64URL 인코딩**:
    - 짧은 문자열 형식으로 전송이 용이하며, HTTP 헤더 등 제한적인 전송 채널에서도 효율적으로 전달 가능합니다.

---

### **JWT 사용 시 보안 고려 사항**

1. **서명 검증**:
    - 서버는 클라이언트가 전송한 JWT의 서명을 검증하여, 변조된 토큰이 아닌지 확인해야 합니다.
2. **만료 시간 설정**:
    - JWT는 `exp` 클레임을 사용하여 만료 시간을 설정하며, 만료된 토큰은 서버에서 거부됩니다.
3. **HTTPS 사용**:
    - 토큰이 전송되는 과정에서 탈취될 수 있으므로, **HTTPS**를 통해 암호화된 상태로 전송하는 것이 중요합니다.
4. **저장 위치**:
    - 클라이언트는 토큰을 안전하게 저장해야 하며, 쿠키에 저장할 경우 `HttpOnly`와 `Secure` 속성을 설정하여 XSS 및 CSRF 공격을 방지하는 것이 좋습니다.

---

## **JWT 사용 사례**

### 1. **인증(Authentication)**
    - 사용자 로그인 후 서버는 사용자에 대한 정보를 담은 JWT를 생성하여 클라이언트에 반환합니다. 클라이언트는 매 요청마다 이 토큰을 전송해 인증 과정을 대체할 수 있습니다.

### 2. **권한 부여(Authorization)**
    - JWT는 페이로드에 사용자의 권한 정보를 포함하므로, 서버는 이를 통해 사용자가 요청한 리소스에 접근할 수 있는지를 판단합니다.

### 3. **정보 교환(Data Exchange)**
    - 서명이 포함된 JWT는 발행자의 신뢰성을 증명하며, 안전한 정보 교환 방식을 제공하므로 다양한 서비스 간 데이터 전송 시 활용될 수 있습니다.

---

## **토큰 기반 인증의 장점과 한계**

### **장점**:
1. **서버 부담 감소**: 상태 비저장 방식으로 서버의 세션 저장 부담을 덜어주며, 분산 서버 환경에서 유연하게 인증을 유지할 수 있습니다.
2. **확장성**: 서버가 사용자 세션을 관리하지 않기 때문에 서버 확장이 용이합니다.

### **한계**:
1. **보안 리스크**: 토큰이 탈취되면 악용될 가능성이 있으므로, 클라이언트가 이를 안전하게 저장하고 전송하는 방법이 중요합니다.
2. **토큰 무효화의 어려움**: 토큰을 강제로 무효화하거나 폐기하기 어렵기 때문에, 이를 해결하기 위해 블랙리스트 관리나 주기적인 토큰 갱신을 고려해야 합니다.

---

JWT와 토큰 기반 인증 방식은 현대 웹 애플리케이션에서 필수적인 보안 메커니즘으로 자리 잡았습니다.